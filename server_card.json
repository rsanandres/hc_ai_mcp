{
  "version": "1.0",
  "serverInfo": {
    "name": "hc-ai-mcp",
    "title": "HC-AI MCP Server",
    "version": "1.0.1"
  },
  "description": "AI-powered MCP server for searching and conversing over FHIR R4 clinical documents. Features hybrid retrieval (BM25 + pgvector), cross-encoder reranking, LangGraph multi-agent workflow, PII masking, and multi-provider LLM support.",
  "documentationUrl": "https://github.com/rsanandres/hc_ai_mcp",
  "transport": {
    "type": "streamable-http",
    "endpoint": "/mcp/"
  },
  "capabilities": {
    "tools": true
  },
  "tools": [
    {
      "name": "agent_query",
      "description": "Query the HC-AI agent with a natural language question. Uses a multi-agent workflow with query classification, hybrid search + reranking, validation, and response synthesis.",
      "inputSchema": {
        "type": "object",
        "required": ["query", "session_id"],
        "properties": {
          "query": {"type": "string", "description": "The natural language question to ask"},
          "session_id": {"type": "string", "description": "Session identifier for conversation context"},
          "patient_id": {"type": "string", "description": "Optional patient ID to filter results"}
        }
      }
    },
    {
      "name": "agent_clear_session",
      "description": "Clear agent session history for a given session ID.",
      "inputSchema": {
        "type": "object",
        "required": ["session_id"],
        "properties": {
          "session_id": {"type": "string", "description": "Session identifier to clear"}
        }
      }
    },
    {
      "name": "agent_health",
      "description": "Check agent health status and configuration.",
      "inputSchema": {"type": "object", "properties": {}}
    },
    {
      "name": "rerank",
      "description": "Rerank documents by relevance to a query using cross-encoder models.",
      "inputSchema": {
        "type": "object",
        "required": ["query"],
        "properties": {
          "query": {"type": "string", "description": "The search query"},
          "k_retrieve": {"type": "integer", "default": 50, "description": "Number of candidates to retrieve"},
          "k_return": {"type": "integer", "default": 10, "description": "Number of results to return"},
          "filter_metadata": {"type": "object", "description": "Optional metadata filters"}
        }
      }
    },
    {
      "name": "rerank_with_context",
      "description": "Rerank documents with optional full FHIR bundle context.",
      "inputSchema": {
        "type": "object",
        "required": ["query"],
        "properties": {
          "query": {"type": "string", "description": "The search query"},
          "k_retrieve": {"type": "integer", "default": 50, "description": "Number of candidates to retrieve"},
          "k_return": {"type": "integer", "default": 10, "description": "Number of results to return"},
          "include_full_json": {"type": "boolean", "default": false, "description": "Include full FHIR JSON in results"},
          "filter_metadata": {"type": "object", "description": "Optional metadata filters"}
        }
      }
    },
    {
      "name": "batch_rerank",
      "description": "Batch rerank multiple queries in parallel.",
      "inputSchema": {
        "type": "object",
        "required": ["items"],
        "properties": {
          "items": {"type": "array", "description": "List of query objects to rerank", "items": {"type": "object"}}
        }
      }
    },
    {
      "name": "session_append_turn",
      "description": "Append a conversation turn to session history.",
      "inputSchema": {
        "type": "object",
        "required": ["session_id", "role", "text"],
        "properties": {
          "session_id": {"type": "string", "description": "Session identifier"},
          "role": {"type": "string", "description": "Role of the speaker (user/assistant)"},
          "text": {"type": "string", "description": "The message text"},
          "meta": {"type": "object", "description": "Optional metadata"},
          "patient_id": {"type": "string", "description": "Optional patient ID"},
          "return_limit": {"type": "integer", "default": 10, "description": "Max recent turns to return"}
        }
      }
    },
    {
      "name": "session_get",
      "description": "Get session state including recent turns and summary.",
      "inputSchema": {
        "type": "object",
        "required": ["session_id"],
        "properties": {
          "session_id": {"type": "string", "description": "Session identifier"},
          "limit": {"type": "integer", "default": 10, "description": "Max recent turns to return"}
        }
      }
    },
    {
      "name": "session_update_summary",
      "description": "Update the session summary.",
      "inputSchema": {
        "type": "object",
        "required": ["session_id", "summary"],
        "properties": {
          "session_id": {"type": "string", "description": "Session identifier"},
          "summary": {"type": "object", "description": "Summary data to store"},
          "patient_id": {"type": "string", "description": "Optional patient ID"}
        }
      }
    },
    {
      "name": "session_clear",
      "description": "Clear all session data for a session ID.",
      "inputSchema": {
        "type": "object",
        "required": ["session_id"],
        "properties": {
          "session_id": {"type": "string", "description": "Session identifier to clear"}
        }
      }
    },
    {
      "name": "ingest",
      "description": "Ingest a clinical note for chunking and embedding into the vector database.",
      "inputSchema": {
        "type": "object",
        "required": ["id", "resource_type", "content"],
        "properties": {
          "id": {"type": "string", "description": "Unique resource identifier"},
          "resource_type": {"type": "string", "description": "FHIR resource type"},
          "content": {"type": "string", "description": "Clinical note text content"},
          "patient_id": {"type": "string", "default": "unknown", "description": "Patient identifier"},
          "full_url": {"type": "string", "description": "Full FHIR resource URL"},
          "resource_json": {"type": "string", "description": "Raw FHIR JSON"},
          "source_file": {"type": "string", "description": "Source file path"}
        }
      }
    },
    {
      "name": "embeddings_health",
      "description": "Check embeddings service health and configuration.",
      "inputSchema": {"type": "object", "properties": {}}
    },
    {
      "name": "db_stats",
      "description": "Get database connection and queue statistics.",
      "inputSchema": {"type": "object", "properties": {}}
    },
    {
      "name": "db_queue",
      "description": "Get ingestion queue status.",
      "inputSchema": {"type": "object", "properties": {}}
    },
    {
      "name": "db_errors",
      "description": "Get error logs with optional filtering.",
      "inputSchema": {
        "type": "object",
        "properties": {
          "limit": {"type": "integer", "default": 100, "description": "Max errors to return"},
          "offset": {"type": "integer", "default": 0, "description": "Offset for pagination"},
          "error_type": {"type": "string", "description": "Filter by error type"}
        }
      }
    }
  ]
}
